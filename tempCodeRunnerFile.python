from flask import Flask, request, jsonify
import openai

app = Flask(__name__)

openai.api_type = "azure"
openai.api_base = "https://careerhackers-ai.openai.azure.com/"
openai.api_version = "2023-03-15-preview"
openai.api_key = "6fc9e8f7aa4d4bfea49dc967ade39736"

@app.route('/generate', methods=['POST'])
def get_response():
    # Retrieve the payload from the request
    payload = request.json['payload']

    system_prompt = '...'  # Your system prompt here
    api_messages = [{'role':'system','content': system_prompt}]
    api_messages.append({'role':'user','content': payload})

    response = openai.ChatCompletion.create(
        engine="Test",
        messages = api_messages,
        temperature=0.65,
        max_tokens=800,
        top_p=0.95,
        frequency_penalty=0,
        presence_penalty=0,
        stop=None)
        
    output_message = response["choices"][0]["message"]["content"]
    api_messages.append({'role':'assistant','content':output_message})

    return jsonify({'message': output_message})

if __name__ == "__main__":
    app.run(port=5000, debug=True)
